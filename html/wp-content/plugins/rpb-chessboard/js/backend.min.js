var RPBChessboard={};!function(RPBChessboard,$){"use strict";RPBChessboard.i18n={EDITOR_BUTTON_LABEL:"chessboard",EDIT_CHESS_DIAGRAM_DIALOG_TITLE:"Insert/edit a chess diagram",CANCEL_BUTTON_LABEL:"Cancel",SUBMIT_BUTTON_ADD_LABEL:"Add a new chess diagram",SUBMIT_BUTTON_EDIT_LABEL:"Update the chess diagram",UNDO_TOOLTIP:"Undo the last modification",REDO_TOOLTIP:"Re-do the last modification",FLIP_CHECKBOX_LABEL:"Flip the board",STANDARD_POSITIONS_TAB_LABEL:"Standard positions",START_POSITION_TOOLTIP:"Set the initial position",EMPTY_POSITION_TOOLTIP:"Clear the chessboard",ANNOTATIONS_TAB_LABEL:"Annotations",SQUARE_MARKERS_SECTION_TITLE:"Square markers",DELETE_SQUARE_MARKERS_TOOLTIP:"Remove the square markers",ARROW_MARKERS_SECTION_TITLE:"Arrow markers",DELETE_ARROW_MARKERS_TOOLTIP:"Remove the arrow markers",ADVANCED_TAB_LABEL:"Advanced settings",CASTLING_SECTION_TITLE:"Castling rights",EN_PASSANT_SECTION_TITLE:"En passant",EN_PASSANT_DISABLED_BUTTON_LABEL:"Not possible",EN_PASSANT_ENABLED_BUTTON_LABEL:"Possible on column %1$s",KEYBOARD_SHORTCUTS_TAB_LABEL:"Keyboard shortcuts",UNDO_SHORTCUT_LABEL:"undo",REDO_SHORTCUT_LABEL:"redo",ADD_PAWNS_SHORTCUT_LABEL:"add pawns",ADD_KNIGHTS_SHORTCUT_LABEL:"add knights",ADD_BISHOPS_SHORTCUT_LABEL:"add bishops",ADD_ROOKS_SHORTCUT_LABEL:"add rooks",ADD_QUEENS_SHORTCUT_LABEL:"add queens",ADD_KINGS_SHORTCUT_LABEL:"add kings"},RPBChessboard.config={FEN_SHORTCODE:"fen"};var undoHistory=[],nextActionIndex=0,shuntUndoHistoryListeners=!1,dialogCallback=null,dialogOptions={};function pushActionOnUndoHistory(callback,oldValue,newValue){nextActionIndex<undoHistory.length&&(undoHistory=undoHistory.slice(0,nextActionIndex)),undoHistory.push({callback:callback,undoValue:oldValue,redoValue:newValue}),++nextActionIndex,$("#rpbchessboard-editFENDialog-undo").button("enable"),$("#rpbchessboard-editFENDialog-redo").button("disable")}function undo(){0!==nextActionIndex&&(executeUndoRedoCallback(undoHistory[--nextActionIndex].callback,undoHistory[nextActionIndex].undoValue),$("#rpbchessboard-editFENDialog-undo").button(0===nextActionIndex?"disable":"enable"),$("#rpbchessboard-editFENDialog-redo").button("enable"))}function redo(){nextActionIndex!==undoHistory.length&&(executeUndoRedoCallback(undoHistory[nextActionIndex].callback,undoHistory[nextActionIndex].redoValue),++nextActionIndex,$("#rpbchessboard-editFENDialog-undo").button("enable"),$("#rpbchessboard-editFENDialog-redo").button(nextActionIndex===undoHistory.length?"disable":"enable"))}function executeUndoRedoCallback(callback,value){shuntUndoHistoryListeners=!0,callback(value),shuntUndoHistoryListeners=!1}function switchInteractionMode(newMode){var cb=$("#rpbchessboard-editFENDialog-chessboard"),oldMode=cb.chessboard("option","interactionMode");$("#rpbchessboard-editFENDialog-"+oldMode).prop("checked",!1).button("refresh"),void 0===newMode||newMode===oldMode?cb.chessboard("option","interactionMode","movePieces"):(cb.chessboard("option","interactionMode",newMode),$("#rpbchessboard-editFENDialog-"+newMode).prop("checked",!0).button("refresh"))}function resetPosition(fen){var cb=$("#rpbchessboard-editFENDialog-chessboard");cb.chessboard("option","position",fen),$("#rpbchessboard-editFENDialog-turn-"+cb.chessboard("turn")).prop("checked",!0),$("#rpbchessboard-editFENDialog-turnSelector input").button("refresh"),$("#rpbchessboard-editFENDialog-castle-wk").prop("checked",cb.chessboard("castling","wk")),$("#rpbchessboard-editFENDialog-castle-wq").prop("checked",cb.chessboard("castling","wq")),$("#rpbchessboard-editFENDialog-castle-bk").prop("checked",cb.chessboard("castling","bk")),$("#rpbchessboard-editFENDialog-castle-bq").prop("checked",cb.chessboard("castling","bq"));var enPassant=cb.chessboard("enPassant");$("#rpbchessboard-editFENDialog-enPassant-"+("-"===enPassant?"disabled":"enabled")).prop("checked",!0),$("#rpbchessboard-editFENDialog-enPassant-column").prop("disabled","-"===enPassant),"-"!==enPassant&&$("#rpbchessboard-editFENDialog-enPassant-column").val(enPassant)}function resetEditFENDialog(fen,isAddMode,options){shuntUndoHistoryListeners=!0;var cb=$("#rpbchessboard-editFENDialog-chessboard");if(resetPosition(fen),"object"==typeof options&&null!==options){var flip="flip"in options?function(s){if("boolean"==typeof s)return s;if("string"!=typeof s)return null;switch(s.toLowerCase()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":return!1;default:return null}}(options.flip):null;null===flip&&(flip=!1),cb.chessboard("option","flip",flip),$("#rpbchessboard-editFENDialog-flip").prop("checked",flip),cb.chessboard("option","squareMarkers","csl"in options?options.csl:""),cb.chessboard("option","arrowMarkers","cal"in options?options.cal:"")}else cb.chessboard("option","squareMarkers",""),cb.chessboard("option","arrowMarkers","");switchInteractionMode(),undoHistory=[],nextActionIndex=0,$("#rpbchessboard-editFENDialog-undo").button("disable"),$("#rpbchessboard-editFENDialog-redo").button("disable"),$("#rpbchessboard-editFENDialog-submitButton").button("option","label",isAddMode?RPBChessboard.i18n.SUBMIT_BUTTON_ADD_LABEL:RPBChessboard.i18n.SUBMIT_BUTTON_EDIT_LABEL),shuntUndoHistoryListeners=!1}function searchFrom(str,pos,re){if(pos>str.length)return-1;var retVal=str.substr(pos).search(re);return retVal<0?-1:retVal+pos}RPBChessboard.showEditFENDialog=function(args){!function(){if(0===$("#rpbchessboard-editFENDialog").length){$("body").append('<div id="rpbchessboard-editFENDialog"><div class="rpbchessboard-columns"><div style="min-width:425px;"><div class="rpbchessboard-jQuery-enableSmoothness"><div class="rpbchessboard-toolbar rpbui-chessboard-size30"><div id="rpbchessboard-editFENDialog-addPiecesSelector" class="rpbchessboard-buttonSet"><div class="rpbchessboard-buttonRow"><input type="checkbox" id="rpbchessboard-editFENDialog-addPieces-wp" name="interactionMode" value="addPieces-wp" /><input type="checkbox" id="rpbchessboard-editFENDialog-addPieces-wn" name="interactionMode" value="addPieces-wn" /><input type="checkbox" id="rpbchessboard-editFENDialog-addPieces-wb" name="interactionMode" value="addPieces-wb" /><input type="checkbox" id="rpbchessboard-editFENDialog-addPieces-wr" name="interactionMode" value="addPieces-wr" /><input type="checkbox" id="rpbchessboard-editFENDialog-addPieces-wq" name="interactionMode" value="addPieces-wq" /><input type="checkbox" id="rpbchessboard-editFENDialog-addPieces-wk" name="interactionMode" value="addPieces-wk" /><label for="rpbchessboard-editFENDialog-addPieces-wp" class="rpbchessboard-graphicButton"><div class="rpbui-chessboard-sized rpbui-chessboard-piece-wp"></div></label><label for="rpbchessboard-editFENDialog-addPieces-wn" class="rpbchessboard-graphicButton"><div class="rpbui-chessboard-sized rpbui-chessboard-piece-wn"></div></label><label for="rpbchessboard-editFENDialog-addPieces-wb" class="rpbchessboard-graphicButton"><div class="rpbui-chessboard-sized rpbui-chessboard-piece-wb"></div></label><label for="rpbchessboard-editFENDialog-addPieces-wr" class="rpbchessboard-graphicButton"><div class="rpbui-chessboard-sized rpbui-chessboard-piece-wr"></div></label><label for="rpbchessboard-editFENDialog-addPieces-wq" class="rpbchessboard-graphicButton"><div class="rpbui-chessboard-sized rpbui-chessboard-piece-wq"></div></label><label for="rpbchessboard-editFENDialog-addPieces-wk" class="rpbchessboard-graphicButton"><div class="rpbui-chessboard-sized rpbui-chessboard-piece-wk"></div></label></div><div class="rpbchessboard-buttonRow"><input type="checkbox" id="rpbchessboard-editFENDialog-addPieces-bp" name="interactionMode" value="addPieces-bp" /><input type="checkbox" id="rpbchessboard-editFENDialog-addPieces-bn" name="interactionMode" value="addPieces-bn" /><input type="checkbox" id="rpbchessboard-editFENDialog-addPieces-bb" name="interactionMode" value="addPieces-bb" /><input type="checkbox" id="rpbchessboard-editFENDialog-addPieces-br" name="interactionMode" value="addPieces-br" /><input type="checkbox" id="rpbchessboard-editFENDialog-addPieces-bq" name="interactionMode" value="addPieces-bq" /><input type="checkbox" id="rpbchessboard-editFENDialog-addPieces-bk" name="interactionMode" value="addPieces-bk" /><label for="rpbchessboard-editFENDialog-addPieces-bp" class="rpbchessboard-graphicButton"><div class="rpbui-chessboard-sized rpbui-chessboard-piece-bp"></div></label><label for="rpbchessboard-editFENDialog-addPieces-bn" class="rpbchessboard-graphicButton"><div class="rpbui-chessboard-sized rpbui-chessboard-piece-bn"></div></label><label for="rpbchessboard-editFENDialog-addPieces-bb" class="rpbchessboard-graphicButton"><div class="rpbui-chessboard-sized rpbui-chessboard-piece-bb"></div></label><label for="rpbchessboard-editFENDialog-addPieces-br" class="rpbchessboard-graphicButton"><div class="rpbui-chessboard-sized rpbui-chessboard-piece-br"></div></label><label for="rpbchessboard-editFENDialog-addPieces-bq" class="rpbchessboard-graphicButton"><div class="rpbui-chessboard-sized rpbui-chessboard-piece-bq"></div></label><label for="rpbchessboard-editFENDialog-addPieces-bk" class="rpbchessboard-graphicButton"><div class="rpbui-chessboard-sized rpbui-chessboard-piece-bk"></div></label></div></div><div id="rpbchessboard-editFENDialog-turnSelector" class="rpbchessboard-buttonSet"><div class="rpbchessboard-buttonRow"><input type="radio" id="rpbchessboard-editFENDialog-turn-w" name="turn" value="w" /><label for="rpbchessboard-editFENDialog-turn-w" class="rpbchessboard-graphicButton"><div class="rpbui-chessboard-sized rpbui-chessboard-color-w rpbui-chessboard-turnFlag"></div></label></div><div class="rpbchessboard-buttonRow"><input type="radio" id="rpbchessboard-editFENDialog-turn-b" name="turn" value="b" /><label for="rpbchessboard-editFENDialog-turn-b" class="rpbchessboard-graphicButton"><div class="rpbui-chessboard-sized rpbui-chessboard-color-b rpbui-chessboard-turnFlag"></div></label></div></div><div class="rpbchessboard-toolbarGroup"><div><button id="rpbchessboard-editFENDialog-undo" class="rpbchessboard-graphicButton" title="'+RPBChessboard.i18n.UNDO_TOOLTIP+'"><div class="rpbchessboard-undoIcon"></div></button><button id="rpbchessboard-editFENDialog-redo" class="rpbchessboard-graphicButton" title="'+RPBChessboard.i18n.REDO_TOOLTIP+'"><div class="rpbchessboard-redoIcon"></div></button></div><div id="rpbchessboard-editFENDialog-flipSelector"><input id="rpbchessboard-editFENDialog-flip" type="checkbox" /><label for="rpbchessboard-editFENDialog-flip">'+RPBChessboard.i18n.FLIP_CHECKBOX_LABEL+'</label></div></div></div></div><div id="rpbchessboard-editFENDialog-chessboard"></div></div><div class="rpbchessboard-stretchable"><div class="rpbchessboard-jQuery-enableSmoothness"><div id="rpbchessboard-editFENDialog-accordion"><h3>'+RPBChessboard.i18n.STANDARD_POSITIONS_TAB_LABEL+'</h3><div><div class="rpbchessboard-editFENDialog-buttonColumn"><div><button id="rpbchessboard-editFENDialog-startPosition" class="rpbchessboard-graphicButton" title="'+RPBChessboard.i18n.START_POSITION_TOOLTIP+'"><div class="rpbchessboard-startPositionIcon"></div></button></div><div><button id="rpbchessboard-editFENDialog-emptyPosition" class="rpbchessboard-graphicButton" title="'+RPBChessboard.i18n.EMPTY_POSITION_TOOLTIP+'"><div class="rpbchessboard-emptyPositionIcon"></div></button></div></div></div><h3>'+RPBChessboard.i18n.ANNOTATIONS_TAB_LABEL+'</h3><div><div class="rpbchessboard-editFENDialog-sectionTitle">'+RPBChessboard.i18n.SQUARE_MARKERS_SECTION_TITLE+'</div><div class="rpbchessboard-editFENDialog-sectionContent"><div class="rpbchessboard-toolbar"><div id="rpbchessboard-editFENDialog-addSquareMarkersSelector" class="rpbchessboard-buttonSet"><div class="rpbchessboard-buttonRow"><input type="checkbox" id="rpbchessboard-editFENDialog-addSquareMarkers-G" name="interactionMode" value="addSquareMarkers-G" /><input type="checkbox" id="rpbchessboard-editFENDialog-addSquareMarkers-R" name="interactionMode" value="addSquareMarkers-R" /><input type="checkbox" id="rpbchessboard-editFENDialog-addSquareMarkers-Y" name="interactionMode" value="addSquareMarkers-Y" /><label for="rpbchessboard-editFENDialog-addSquareMarkers-G" class="rpbchessboard-graphicButton"><div class="rpbchessboard-squareMarkerGreenIcon"></div></label><label for="rpbchessboard-editFENDialog-addSquareMarkers-R" class="rpbchessboard-graphicButton"><div class="rpbchessboard-squareMarkerRedIcon"></div></label><label for="rpbchessboard-editFENDialog-addSquareMarkers-Y" class="rpbchessboard-graphicButton"><div class="rpbchessboard-squareMarkerYellowIcon"></div></label></div></div><button id="rpbchessboard-editFENDialog-deleteSquareMarkers" class="rpbchessboard-graphicButton" title="'+RPBChessboard.i18n.DELETE_SQUARE_MARKERS_TOOLTIP+'"><div class="rpbchessboard-deleteIcon"></div></button></div></div><div class="rpbchessboard-editFENDialog-sectionTitle">'+RPBChessboard.i18n.ARROW_MARKERS_SECTION_TITLE+'</div><div class="rpbchessboard-editFENDialog-sectionContent"><div class="rpbchessboard-toolbar"><div id="rpbchessboard-editFENDialog-addArrowMarkersSelector" class="rpbchessboard-buttonSet"><div class="rpbchessboard-buttonRow"><input type="checkbox" id="rpbchessboard-editFENDialog-addArrowMarkers-G" name="interactionMode" value="addArrowMarkers-G" /><input type="checkbox" id="rpbchessboard-editFENDialog-addArrowMarkers-R" name="interactionMode" value="addArrowMarkers-R" /><input type="checkbox" id="rpbchessboard-editFENDialog-addArrowMarkers-Y" name="interactionMode" value="addArrowMarkers-Y" /><label for="rpbchessboard-editFENDialog-addArrowMarkers-G" class="rpbchessboard-graphicButton"><div class="rpbchessboard-arrowMarkerGreenIcon"></div></label><label for="rpbchessboard-editFENDialog-addArrowMarkers-R" class="rpbchessboard-graphicButton"><div class="rpbchessboard-arrowMarkerRedIcon"></div></label><label for="rpbchessboard-editFENDialog-addArrowMarkers-Y" class="rpbchessboard-graphicButton"><div class="rpbchessboard-arrowMarkerYellowIcon"></div></label></div></div><button id="rpbchessboard-editFENDialog-deleteArrowMarkers" class="rpbchessboard-graphicButton" title="'+RPBChessboard.i18n.DELETE_ARROW_MARKERS_TOOLTIP+'"><div class="rpbchessboard-deleteIcon"></div></button></div></div></div><h3>'+RPBChessboard.i18n.ADVANCED_TAB_LABEL+'</h3><div><div class="rpbchessboard-editFENDialog-sectionTitle">'+RPBChessboard.i18n.CASTLING_SECTION_TITLE+'</div><div class="rpbchessboard-editFENDialog-sectionContent"><table id="rpbchessboard-editFENDialog-castling" class="rpbui-chessboard-size28"><tbody><tr><td></td><td>O-O-O</td><td>O-O</td></tr><tr><td><span class="rpbchessboard-editFENDialog-turnFlag rpbui-chessboard-turnFlag rpbui-chessboard-color-b rpbui-chessboard-sized"></span></td><td><input id="rpbchessboard-editFENDialog-castle-bq" type="checkbox" data-castle="bq" /></td><td><input id="rpbchessboard-editFENDialog-castle-bk" type="checkbox" data-castle="bk" /></td></tr><tr><td><span class="rpbchessboard-editFENDialog-turnFlag rpbui-chessboard-turnFlag rpbui-chessboard-color-w rpbui-chessboard-sized"></span></td><td><input id="rpbchessboard-editFENDialog-castle-wq" type="checkbox" data-castle="wq" /></td><td><input id="rpbchessboard-editFENDialog-castle-wk" type="checkbox" data-castle="wk" /></td></tr></tbody></table></div><div class="rpbchessboard-editFENDialog-sectionTitle">'+RPBChessboard.i18n.EN_PASSANT_SECTION_TITLE+'</div><div class="rpbchessboard-editFENDialog-sectionContent"><ul id="rpbchessboard-editFENDialog-enPassantRights"><li><input id="rpbchessboard-editFENDialog-enPassant-disabled" type="radio" name="enPassant" /><label for="rpbchessboard-editFENDialog-enPassant-disabled">'+RPBChessboard.i18n.EN_PASSANT_DISABLED_BUTTON_LABEL+'</label></li><li><input id="rpbchessboard-editFENDialog-enPassant-enabled" type="radio" name="enPassant" /><label for="rpbchessboard-editFENDialog-enPassant-enabled">'+RPBChessboard.i18n.EN_PASSANT_ENABLED_BUTTON_LABEL.replace("%1$s",'</label><select id="rpbchessboard-editFENDialog-enPassant-column"><option value="a">a</option><option value="b">b</option><option value="c">c</option><option value="d">d</option><option value="e">e</option><option value="f">f</option><option value="g">g</option><option value="h">h</option></select><label for="rpbchessboard-editFENDialog-enPassant-enabled">')+"</label></li></ul></div></div><h3>"+RPBChessboard.i18n.KEYBOARD_SHORTCUTS_TAB_LABEL+'</h3><div><div class="rpbchessboard-editFENDialog-sectionContent"><ul><li><span class="rpbchessboard-keyboardShortcut">Ctrl+Z</span>'+RPBChessboard.i18n.UNDO_SHORTCUT_LABEL+'</li><li><span class="rpbchessboard-keyboardShortcut">Ctrl+Y</span>'+RPBChessboard.i18n.REDO_SHORTCUT_LABEL+'</li><li><span class="rpbchessboard-keyboardShortcut">P</span>'+RPBChessboard.i18n.ADD_PAWNS_SHORTCUT_LABEL+'</li><li><span class="rpbchessboard-keyboardShortcut">N</span>'+RPBChessboard.i18n.ADD_KNIGHTS_SHORTCUT_LABEL+'</li><li><span class="rpbchessboard-keyboardShortcut">B</span>'+RPBChessboard.i18n.ADD_BISHOPS_SHORTCUT_LABEL+'</li><li><span class="rpbchessboard-keyboardShortcut">R</span>'+RPBChessboard.i18n.ADD_ROOKS_SHORTCUT_LABEL+'</li><li><span class="rpbchessboard-keyboardShortcut">Q</span>'+RPBChessboard.i18n.ADD_QUEENS_SHORTCUT_LABEL+'</li><li><span class="rpbchessboard-keyboardShortcut">K</span>'+RPBChessboard.i18n.ADD_KINGS_SHORTCUT_LABEL+"</li></ul></div></div></div></div></div></div></div>");var cb=$("#rpbchessboard-editFENDialog-chessboard");cb.chessboard({squareSize:40,interactionMode:"movePieces",positionChange:function(event,ui){shuntUndoHistoryListeners||pushActionOnUndoHistory(function(value){resetPosition(value)},ui.oldValue,ui.newValue)},flipChange:function(event,ui){shuntUndoHistoryListeners||pushActionOnUndoHistory(function(value){cb.chessboard("option","flip",value),$("#rpbchessboard-editFENDialog-flip").prop("checked",value)},ui.oldValue,ui.newValue)},squareMarkersChange:function(event,ui){shuntUndoHistoryListeners||pushActionOnUndoHistory(function(value){cb.chessboard("option","squareMarkers",value)},ui.oldValue,ui.newValue)},arrowMarkersChange:function(event,ui){shuntUndoHistoryListeners||pushActionOnUndoHistory(function(value){cb.chessboard("option","arrowMarkers",value)},ui.oldValue,ui.newValue)}}),$("#rpbchessboard-editFENDialog-addPiecesSelector input").button().each(function(index,elem){$(elem).click(function(){switchInteractionMode($(elem).val())})}),$("#rpbchessboard-editFENDialog-addSquareMarkersSelector input").button().each(function(index,elem){$(elem).click(function(){switchInteractionMode($(elem).val())})}),$("#rpbchessboard-editFENDialog-addArrowMarkersSelector input").button().each(function(index,elem){$(elem).click(function(){switchInteractionMode($(elem).val())})}),$("#rpbchessboard-editFENDialog-deleteSquareMarkers").button().click(function(){cb.chessboard("option","squareMarkers","")}),$("#rpbchessboard-editFENDialog-deleteArrowMarkers").button().click(function(){cb.chessboard("option","arrowMarkers","")}),$("#rpbchessboard-editFENDialog-turnSelector input").button().each(function(index,elem){$(elem).click(function(){cb.chessboard("turn",$(elem).val())})}),$("#rpbchessboard-editFENDialog-flip").click(function(){cb.chessboard("option","flip",$(this).prop("checked"))}),$("#rpbchessboard-editFENDialog-undo").button().click(function(){undo()}),$("#rpbchessboard-editFENDialog-redo").button().click(function(){redo()}),$("#rpbchessboard-editFENDialog-startPosition").button().click(function(){resetPosition("start")}),$("#rpbchessboard-editFENDialog-emptyPosition").button().click(function(){resetPosition("empty")}),$("#rpbchessboard-editFENDialog-castling input").each(function(index,elem){$(elem).click(function(){cb.chessboard("castling",$(elem).data("castle"),$(elem).prop("checked"))})});var enPassantColumnChooser=$("#rpbchessboard-editFENDialog-enPassant-column");$("#rpbchessboard-editFENDialog-enPassant-disabled").click(function(){enPassantColumnChooser.prop("disabled",!0),cb.chessboard("enPassant","-")}),$("#rpbchessboard-editFENDialog-enPassant-enabled").click(function(){enPassantColumnChooser.prop("disabled",!1),enPassantColumnChooser.change()}),enPassantColumnChooser.change(function(){cb.chessboard("enPassant",enPassantColumnChooser.val())}),$("#rpbchessboard-editFENDialog-accordion").accordion(),$("#rpbchessboard-editFENDialog").dialog({autoOpen:!1,modal:!0,dialogClass:"wp-dialog",title:RPBChessboard.i18n.EDIT_CHESS_DIAGRAM_DIALOG_TITLE,width:750,buttons:[{text:RPBChessboard.i18n.CANCEL_BUTTON_LABEL,click:function(){$(this).dialog("close")}},{class:"button-primary",id:"rpbchessboard-editFENDialog-submitButton",text:"",click:function(){$(this).dialog("close"),null!==dialogCallback&&(dialogOptions.flip=cb.chessboard("option","flip"),dialogOptions.csl=cb.chessboard("option","squareMarkers"),dialogOptions.cal=cb.chessboard("option","arrowMarkers"),dialogCallback(cb.chessboard("option","position"),dialogOptions))}}]}),$(document).keypress(function(event){if($("#rpbchessboard-editFENDialog").dialog("isOpen"))if(event.altKey||!event.ctrlKey||event.metaKey||event.shiftKey){if(!event.altKey&&!event.ctrlKey&&!event.metaKey&&!event.shiftKey&&0<="pnbrqk".indexOf(event.key)){var mode=$("#rpbchessboard-editFENDialog-chessboard").chessboard("option","interactionMode"),targetedModeW="addPieces-w"+event.key,targetedModeB="addPieces-b"+event.key;switchInteractionMode(mode===targetedModeW?targetedModeB:mode===targetedModeB?"movePieces":targetedModeW)}}else"z"===event.key?undo():"y"===event.key&&redo()})}}(),"function"==typeof args?(dialogCallback=args,dialogOptions={},resetEditFENDialog("start",!0)):"object"==typeof args&&null!==args?(dialogCallback="callback"in args&&"function"==typeof args.callback?args.callback:null,dialogOptions="options"in args&&"object"==typeof args.options?args.options:{},resetEditFENDialog(args.fen,!1,dialogOptions)):(dialogCallback=null,dialogOptions={}),$("#rpbchessboard-editFENDialog").dialog("open")},RPBChessboard.parseWordPressShortcodeAttributes=function(openingTag){for(var retVal={},re=/([a-zA-Z_0-9]+)=([^ \]]+)(?: |\])/g,m=null,fun=function(m,p1){return p1.toUpperCase()};null!==(m=re.exec(openingTag));){retVal[m[1].toLowerCase().replace(/_([a-z]?)/g,fun)]=m[2]}return retVal},RPBChessboard.serializeFENShortcodeContent=function(fen,options){var fenShortcode=RPBChessboard.config.FEN_SHORTCODE,res="["+fenShortcode;return"flip"in options&&options.flip&&(res+=" flip=true"),"csl"in options&&""!==options.csl&&(res+=" csl="+options.csl),"cal"in options&&""!==options.cal&&(res+=" cal="+options.cal),"squareSize"in options&&(res+=" square_size="+options.squareSize),"showCoordinates"in options&&(res+=" show_coordinates="+options.showCoordinates),res+="]"+fen+"[/"+fenShortcode+"]"},RPBChessboard.identifyFENShortcodeContent=function(text,beginSelection,endSelection){var fenShortcode=RPBChessboard.config.FEN_SHORTCODE,lgClose=3+fenShortcode.length,reClose=new RegExp("\\[\\/"+fenShortcode+"\\]","g"),posClose=searchFrom(text,Math.max(0,beginSelection-lgClose+1),reClose),reOpen=new RegExp("\\["+fenShortcode+"[^\\[\\]]*\\]","g"),posOpen=posClose<0?-1:function(str,pos,re){str=str.substr(0,pos);for(var retVal=-1;;){var newOccurence=searchFrom(str,retVal+1,re);if(newOccurence<0)break;retVal=newOccurence}return retVal}(text,posClose,reOpen);if(0<=posOpen&&0<=posClose&&posOpen<=beginSelection&&endSelection<=posClose+lgClose){var tagOpen=text.substr(posOpen).match(reOpen)[0],lgOpen=tagOpen.length;return{beginShortcode:posOpen,endShortcode:posClose+lgClose,fen:text.substr(posOpen+lgOpen,posClose-posOpen-lgOpen),options:RPBChessboard.parseWordPressShortcodeAttributes(tagOpen)}}return null}}(RPBChessboard,jQuery);